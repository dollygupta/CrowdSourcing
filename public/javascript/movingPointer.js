var directionDisplay;var directionsService;var stepDisplay;var position;var marker=[];var polyline=[];var poly2=[];var poly=null;var startLocation=[];var endLocation=[];var timerHandle=[];var speed=0.000005,wait=1;var infowindow=null;var myPano;var panoClient;var nextPanoId;function createMarker(latlng,label,html){var contentString='<b>'+label+'</b><br>'+'<p>Started From:</p>'+html;console.log(latlng);var marker=new google.maps.Marker({position:latlng,map:map,icon:'images/emergencyVehicle.png',title:label,zIndex:20});marker.myname=label;google.maps.event.addListener(marker,'click',function(){infowindow.setContent(contentString);infowindow.open(map,marker);});return marker;}
function setRoutes(start,end){var directionsDisplay=new Array();var rendererOptions={map:map,suppressMarkers:true,preserveViewport:true};directionsService=new google.maps.DirectionsService();var travelMode=google.maps.DirectionsTravelMode.DRIVING;var request={origin:start,destination:end,travelMode:travelMode};directionsService.route(request,makeRouteCallback(0,directionsDisplay[0]));function makeRouteCallback(routeNum,disp){return function(response,status){if(status==google.maps.DirectionsStatus.OK){startLocation[routeNum]=new Object();endLocation[routeNum]=new Object();polyline[routeNum]=new google.maps.Polyline({path:[],strokeColor:'#FFFF00',strokeWeight:3});poly2[routeNum]=new google.maps.Polyline({path:[],strokeColor:'#FFFF00',strokeWeight:3});var legs=response.routes[0].legs;disp=new google.maps.DirectionsRenderer(rendererOptions);disp.setMap(map);disp.setDirections(response);for(i=0;i<legs.length;i++){if(i==0){startLocation[routeNum].latlng=legs[i].start_location;startLocation[routeNum].address=legs[i].start_address;marker[routeNum]=createMarker(legs[i].start_location,"start",legs[i].start_address);}
endLocation[routeNum].latlng=legs[i].end_location;endLocation[routeNum].address=legs[i].end_address;console.log(endLocation[routeNum].latlng.lat());var steps=legs[i].steps;for(j=0;j<steps.length;j++){var nextSegment=steps[j].path;for(k=0;k<nextSegment.length;k++){polyline[routeNum].getPath().push(nextSegment[k]);}}}}
polyline[routeNum].setMap(map);startAnimation(routeNum);};}}
var lastVertex=1;var stepnum=0;var step=50;var tick=100;var eol=[];function updatePoly(i,d){if(poly2[i].getPath().getLength()>20){poly2[i]=new google.maps.Polyline([polyline[i].getPath().getAt(lastVertex-1)]);}
if(polyline[i].GetIndexAtDistance(d)<lastVertex+2){if(poly2[i].getPath().getLength()>1){poly2[i].getPath().removeAt(poly2[i].getPath().getLength()-1)}
poly2[i].getPath().insertAt(poly2[i].getPath().getLength(),polyline[i].GetPointAtDistance(d));}else{poly2[i].getPath().insertAt(poly2[i].getPath().getLength(),endLocation[i].latlng);}}
function animate(index,d){if(d>eol[index]){marker[index].setPosition(endLocation[index].latlng);return;}
var p=polyline[index].GetPointAtDistance(d);marker[index].setPosition(p);updatePoly(index,d);timerHandle[index]=setTimeout("animate("+index+","+(d+step)+")",tick);}
function startAnimation(index){if(timerHandle[index])clearTimeout(timerHandle[index]);eol[index]=polyline[index].Distance();map.setCenter(polyline[index].getPath().getAt(0));poly2[index]=new google.maps.Polyline({path:[polyline[index].getPath().getAt(0)],strokeColor:"#FFFF00",strokeWeight:3});timerHandle[index]=setTimeout("animate("+index+",50)",2000);}